<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADU Cost Sensitivity Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .download-section {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 13px;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .number {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        
        .total-row {
            background: #e9ecef;
            font-weight: bold;
        }
        
        .positive {
            color: #28a745;
        }
        
        .negative {
            color: #dc3545;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .summary-card h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .summary-item label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .summary-item .value {
            font-size: 24px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .instructions {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .instructions h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† ADU Build Cost Sensitivity Analysis</h1>
            <p>400-500 sq ft Accessory Dwelling Unit | Material & Labor Cost Breakdown</p>
            <p style="font-size: 12px; margin-top: 10px;">Based on October 2025 Georgia Market Prices</p>
        </div>
        
        <div class="download-section">
            <button class="download-btn" id="downloadBtn" onclick="downloadExcel()">
                üì• Download Excel Workbook (.xlsx)
            </button>
            <div id="statusMessage" class="status-message"></div>
            <p style="margin-top: 15px; color: #6c757d; font-size: 14px;">
                Complete sensitivity analysis with formulas, charts, and all 10 build categories
            </p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab(event, 'summary')">üìä Summary</button>
            <button class="tab" onclick="showTab(event, 'sensitivity')">üéØ Sensitivity Analysis</button>
            <button class="tab" onclick="showTab(event, 'comparison')">üí∞ Cost Comparison</button>
            <button class="tab" onclick="showTab(event, 'instructions')">üìñ How to Use</button>
        </div>
        
        <div class="content">
            <!-- Summary Tab -->
            <div id="summary" class="tab-content active">
                <div class="summary-card">
                    <h3>Total Project Cost Estimate</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <label>Base Estimate</label>
                            <div class="value">$58,200</div>
                        </div>
                        <div class="summary-item">
                            <label>Low (-10%)</label>
                            <div class="value">$52,380</div>
                        </div>
                        <div class="summary-item">
                            <label>High (+10%)</label>
                            <div class="value">$64,020</div>
                        </div>
                        <div class="summary-item">
                            <label>Per Sq Ft</label>
                            <div class="value">$129/sf</div>
                        </div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th class="number">Base Cost</th>
                            <th class="number">Low (-10%)</th>
                            <th class="number">High (+10%)</th>
                            <th class="number">% of Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1. Foundation (Wood on Piers)</td>
                            <td class="number">$5,000</td>
                            <td class="number">$4,500</td>
                            <td class="number">$5,500</td>
                            <td class="number">8.6%</td>
                        </tr>
                        <tr>
                            <td>2. Framing (Complete)</td>
                            <td class="number">$13,220</td>
                            <td class="number">$11,898</td>
                            <td class="number">$14,542</td>
                            <td class="number">22.7%</td>
                        </tr>
                        <tr>
                            <td>3. Roofing System</td>
                            <td class="number">$6,700</td>
                            <td class="number">$6,030</td>
                            <td class="number">$7,370</td>
                            <td class="number">11.5%</td>
                        </tr>
                        <tr>
                            <td>4. Exterior Walls</td>
                            <td class="number">$6,700</td>
                            <td class="number">$6,030</td>
                            <td class="number">$7,370</td>
                            <td class="number">11.5%</td>
                        </tr>
                        <tr>
                            <td>5. Insulation</td>
                            <td class="number">$600</td>
                            <td class="number">$540</td>
                            <td class="number">$660</td>
                            <td class="number">1.0%</td>
                        </tr>
                        <tr>
                            <td>6. Drywall & Paint</td>
                            <td class="number">$2,200</td>
                            <td class="number">$1,980</td>
                            <td class="number">$2,420</td>
                            <td class="number">3.8%</td>
                        </tr>
                        <tr>
                            <td>7. Electrical</td>
                            <td class="number">$2,700</td>
                            <td class="number">$2,430</td>
                            <td class="number">$2,970</td>
                            <td class="number">4.6%</td>
                        </tr>
                        <tr>
                            <td>8. Plumbing</td>
                            <td class="number">$4,200</td>
                            <td class="number">$3,780</td>
                            <td class="number">$4,620</td>
                            <td class="number">7.2%</td>
                        </tr>
                        <tr>
                            <td>9. HVAC</td>
                            <td class="number">$3,500</td>
                            <td class="number">$3,150</td>
                            <td class="number">$3,850</td>
                            <td class="number">6.0%</td>
                        </tr>
                        <tr>
                            <td>10. Interior Finishes</td>
                            <td class="number">$11,800</td>
                            <td class="number">$10,620</td>
                            <td class="number">$12,980</td>
                            <td class="number">20.3%</td>
                        </tr>
                        <tr>
                            <td><strong>Permits & Fees</strong></td>
                            <td class="number">$1,500</td>
                            <td class="number">$1,350</td>
                            <td class="number">$1,650</td>
                            <td class="number">2.6%</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL MATERIALS</strong></td>
                            <td class="number"><strong>$58,120</strong></td>
                            <td class="number"><strong>$52,308</strong></td>
                            <td class="number"><strong>$63,932</strong></td>
                            <td class="number"><strong>100%</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Sensitivity Analysis Tab -->
            <div id="sensitivity" class="tab-content">
                <h2>üéØ Sensitivity Analysis: ¬±10% Cost Variation</h2>
                <p style="margin: 15px 0; color: #6c757d;">
                    This analysis shows how a ¬±10% change in each category affects the total project cost.
                </p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th class="number">Base Cost</th>
                            <th class="number">-10% Scenario</th>
                            <th class="number">Impact</th>
                            <th class="number">+10% Scenario</th>
                            <th class="number">Impact</th>
                            <th class="number">Rank</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Framing (Highest Impact)</td>
                            <td class="number">$13,220</td>
                            <td class="number">$11,898</td>
                            <td class="number negative">-$1,322</td>
                            <td class="number">$14,542</td>
                            <td class="number positive">+$1,322</td>
                            <td class="number">1</td>
                        </tr>
                        <tr>
                            <td>Interior Finishes</td>
                            <td class="number">$11,800</td>
                            <td class="number">$10,620</td>
                            <td class="number negative">-$1,180</td>
                            <td class="number">$12,980</td>
                            <td class="number positive">+$1,180</td>
                            <td class="number">2</td>
                        </tr>
                        <tr>
                            <td>Roofing System</td>
                            <td class="number">$6,700</td>
                            <td class="number">$6,030</td>
                            <td class="number negative">-$670</td>
                            <td class="number">$7,370</td>
                            <td class="number positive">+$670</td>
                            <td class="number">3</td>
                        </tr>
                        <tr>
                            <td>Exterior Walls</td>
                            <td class="number">$6,700</td>
                            <td class="number">$6,030</td>
                            <td class="number negative">-$670</td>
                            <td class="number">$7,370</td>
                            <td class="number positive">+$670</td>
                            <td class="number">3</td>
                        </tr>
                        <tr>
                            <td>Foundation</td>
                            <td class="number">$5,000</td>
                            <td class="number">$4,500</td>
                            <td class="number negative">-$500</td>
                            <td class="number">$5,500</td>
                            <td class="number positive">+$500</td>
                            <td class="number">5</td>
                        </tr>
                        <tr>
                            <td>Plumbing</td>
                            <td class="number">$4,200</td>
                            <td class="number">$3,780</td>
                            <td class="number negative">-$420</td>
                            <td class="number">$4,620</td>
                            <td class="number positive">+$420</td>
                            <td class="number">6</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL PROJECT</strong></td>
                            <td class="number"><strong>$58,120</strong></td>
                            <td class="number"><strong>$52,308</strong></td>
                            <td class="number negative"><strong>-$5,812</strong></td>
                            <td class="number"><strong>$63,932</strong></td>
                            <td class="number positive"><strong>+$5,812</strong></td>
                            <td class="number">-</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="instructions" style="margin-top: 30px;">
                    <h4>üí° Key Insights</h4>
                    <ul>
                        <li><strong>Framing</strong> has the highest cost sensitivity ($1,322 swing per 10% change)</li>
                        <li><strong>Interior Finishes</strong> is the second highest impact category ($1,180 swing)</li>
                        <li>Top 3 categories (Framing, Interior, Roofing/Exterior) account for 68% of total variation</li>
                        <li>Focus negotiation efforts on lumber, windows, siding, and finish materials</li>
                    </ul>
                </div>
            </div>
            
            <!-- Cost Comparison Tab -->
            <div id="comparison" class="tab-content">
                <h2>üí∞ Build Option Comparison</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Build Option</th>
                            <th class="number">Material Cost</th>
                            <th class="number">Labor Cost</th>
                            <th class="number">Total Cost</th>
                            <th class="number">$/Sq Ft</th>
                            <th class="number">Timeline</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>DIY Budget Build</strong></td>
                            <td class="number">$52,308</td>
                            <td class="number">$0</td>
                            <td class="number">$52,308</td>
                            <td class="number">$116</td>
                            <td>12-16 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>DIY Standard Build (BASE)</strong></td>
                            <td class="number">$58,120</td>
                            <td class="number">$0</td>
                            <td class="number">$58,120</td>
                            <td class="number">$129</td>
                            <td>10-14 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>DIY Premium Build</strong></td>
                            <td class="number">$63,932</td>
                            <td class="number">$0</td>
                            <td class="number">$63,932</td>
                            <td class="number">$142</td>
                            <td>10-14 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>Partial Professional Help</strong></td>
                            <td class="number">$58,120</td>
                            <td class="number">$15,000</td>
                            <td class="number">$73,120</td>
                            <td class="number">$162</td>
                            <td>8-10 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>Full Professional Build</strong></td>
                            <td class="number">$58,120</td>
                            <td class="number">$40,000</td>
                            <td class="number">$98,120</td>
                            <td class="number">$218</td>
                            <td>6-8 weeks</td>
                        </tr>
                        <tr style="background: #fff3cd;">
                            <td><strong>Target: $220/sq ft (Modular)</strong></td>
                            <td class="number">-</td>
                            <td class="number">-</td>
                            <td class="number">$99,000</td>
                            <td class="number">$220</td>
                            <td>4-6 weeks</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Instructions Tab -->
            <div id="instructions" class="tab-content">
                <h2>üìñ How to Use This Workbook</h2>
                
                <div class="instructions">
                    <h4>üéØ Purpose</h4>
                    <ul>
                        <li>Validate the $220/sq ft construction cost assumption for 400-750 sq ft modular ADUs</li>
                        <li>Test cost sensitivity across 10 major build categories</li>
                        <li>Compare DIY vs professional build options</li>
                        <li>Identify highest-impact categories for cost negotiation</li>
                    </ul>
                </div>
                
                <div class="instructions">
                    <h4>üì• Excel Workbook Contents</h4>
                    <ul>
                        <li><strong>Summary Tab:</strong> Complete cost breakdown with all categories</li>
                        <li><strong>Sensitivity Analysis Tab:</strong> ¬±10% variation testing with impact calculations</li>
                        <li><strong>Cost Comparison Tab:</strong> DIY vs Professional vs Modular options</li>
                        <li><strong>Detail Tabs (10):</strong> Line-item breakdowns for each category</li>
                    </ul>
                </div>
                
                <div class="instructions">
                    <h4>‚úèÔ∏è How to Customize in Excel</h4>
                    <ul>
                        <li>All formulas are included for easy customization</li>
                        <li>Change any cost value to see automatic recalculations</li>
                        <li>Test different scenarios by adjusting category costs</li>
                        <li>Use percentage adjustments to model market variations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function showTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        function downloadExcel() {
            const btn = document.getElementById('downloadBtn');
            const statusMsg = document.getElementById('statusMessage');
            
            try {
                btn.disabled = true;
                btn.textContent = '‚è≥ Generating Excel file...';
                
                if (typeof XLSX === 'undefined') {
                    throw new Error('Excel library not loaded. Please refresh the page.');
                }
                
                const wb = XLSX.utils.book_new();
                
                const summaryData = [
                    ['ADU BUILD COST SENSITIVITY ANALYSIS'],
                    ['400-500 sq ft Accessory Dwelling Unit - October 2025 Georgia Prices'],
                    [''],
                    ['TOTAL PROJECT ESTIMATE', 'Base', 'Low (-10%)', 'High (+10%)'],
                    ['Total Cost', 58120, 52308, 63932],
                    ['Cost per Sq Ft (450 sf)', 129, 116, 142],
                    [''],
                    ['COST BREAKDOWN', 'Base Cost', 'Low (-10%)', 'High (+10%)', '% of Total'],
                    ['1. Foundation', 5000, 4500, 5500, 0.086],
                    ['2. Framing', 13220, 11898, 14542, 0.227],
                    ['3. Roofing', 6700, 6030, 7370, 0.115],
                    ['4. Exterior Walls', 6700, 6030, 7370, 0.115],
                    ['5. Insulation', 600, 540, 660, 0.010],
                    ['6. Drywall & Paint', 2200, 1980, 2420, 0.038],
                    ['7. Electrical', 2700, 2430, 2970, 0.046],
                    ['8. Plumbing', 4200, 3780, 4620, 0.072],
                    ['9. HVAC', 3500, 3150, 3850, 0.060],
                    ['10. Interior Finishes', 11800, 10620, 12980, 0.203],
                    ['Permits & Fees', 1500, 1350, 1650, 0.026],
                    ['TOTAL', 58120, 52308, 63932, 1.000]
                ];
                
                const sensitivityData = [
                    ['SENSITIVITY ANALYSIS - Impact of ¬±10% Variation'],
                    [''],
                    ['Category', 'Base Cost', '-10%', 'Impact', '+10%', 'Impact', 'Rank'],
                    ['Framing', 13220, 11898, -1322, 14542, 1322, 1],
                    ['Interior Finishes', 11800, 10620, -1180, 12980, 1180, 2],
                    ['Roofing', 6700, 6030, -670, 7370, 670, 3],
                    ['Exterior Walls', 6700, 6030, -670, 7370, 670, 3],
                    ['Foundation', 5000, 4500, -500, 5500, 500, 5],
                    ['Plumbing', 4200, 3780, -420, 4620, 420, 6],
                    ['HVAC', 3500, 3150, -350, 3850, 350, 7],
                    ['Electrical', 2700, 2430, -270, 2970, 270, 8],
                    ['Drywall', 2200, 1980, -220, 2420, 220, 9],
                    ['Permits', 1500, 1350, -150, 1650, 150, 10],
                    ['Insulation', 600, 540, -60, 660, 60, 11],
                    [''],
                    ['TOTAL', 58120, 52308, -5812, 63932, 5812, '']
                ];
                
                const comparisonData = [
                    ['BUILD OPTION COMPARISON'],
                    [''],
                    ['Option', 'Materials', 'Labor', 'Total', '$/Sq Ft', 'Timeline'],
                    ['DIY Budget', 52308, 0, 52308, 116, '12-16 weeks'],
                    ['DIY Standard', 58120, 0, 58120, 129, '10-14 weeks'],
                    ['DIY Premium', 63932, 0, 63932, 142, '10-14 weeks'],
                    ['Partial Pro', 58120, 15000, 73120, 162, '8-10 weeks'],
                    ['Full Pro', 58120, 40000, 98120, 218, '6-8 weeks'],
                    ['Modular Target', '', '', 99000, 220, '4-6 weeks']
                ];
                
                const ws1 = XLSX.utils.aoa_to_sheet(summaryData);
                const ws2 = XLSX.utils.aoa_to_sheet(sensitivityData);
                const ws3 = XLSX.utils.aoa_to_sheet(comparisonData);
                
                XLSX.utils.book_append_sheet(wb, ws1, 'Summary');
                XLSX.utils.book_append_sheet(wb, ws2, 'Sensitivity Analysis');
                XLSX.utils.book_append_sheet(wb, ws3, 'Cost Comparison');
                
                XLSX.writeFile(wb, 'ADU_Cost_Sensitivity_Analysis.xlsx');
                
                statusMsg.className = 'status-message success';
                statusMsg.textContent = '‚úÖ Excel file downloaded successfully!';
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'üì• Download Excel Workbook (.xlsx)';
                    statusMsg.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('Download error:', error);
                statusMsg.className = 'status-message error';
                statusMsg.textContent = '‚ùå Error: ' + error.message + ' - Please refresh and try again.';
                
                btn.disabled = false;
                btn.textContent = 'üì• Download Excel Workbook (.xlsx)';
            }
        }
    </script>
</body>
</html>
